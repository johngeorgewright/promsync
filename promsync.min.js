Object.defineProperty(exports,"__esModule",{value:!0});
var _slicedToArray=function(){return function(b,a){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b)){var c=[],d=!0,e=!1,f=void 0;try{for(var k=b[Symbol.iterator](),h;!(d=(h=k.next()).done)&&(c.push(h.value),!a||c.length!==a);d=!0);}catch(g){e=!0,f=g}finally{try{if(!d&&k["return"])k["return"]()}finally{if(e)throw f;}}return c}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),_get=function(b,a,c){var d=!0;for(;d;)if(null===b&&(b=Function.prototype),d=Object.getOwnPropertyDescriptor(b,
a),void 0===d){b=Object.getPrototypeOf(b);if(null===b)break;d=!0}else{if("value"in d)return d.value;a=d.get;return void 0===a?void 0:a.call(c)}};function _classCallCheck(b,a){if(!(b instanceof a))throw new TypeError("Cannot call a class as a function");}
function _inherits(b,a){if("function"!==typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);b.prototype=Object.create(a&&a.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}});a&&(b.__proto__=a)}var Break=function(b){function a(){_classCallCheck(this,a);_get(Object.getPrototypeOf(a.prototype),"constructor",this).apply(this,arguments)}_inherits(a,b);return a}(Error);
function stoppable(b){return b["catch"](function(a){if(!(a instanceof Break))throw a;})}var Promsync=function(b){function a(){_classCallCheck(this,a);_get(Object.getPrototypeOf(a.prototype),"constructor",this).apply(this,arguments)}_inherits(a,b);return a}(Promise);exports["default"]=Promsync;function identity(b){return b}
function addFn(b){var a=b.name;Promsync[a]=b.bind(Promsync.resolve());Promsync.prototype[a]=function(){for(var a=this,d=arguments.length,e=Array(d),f=0;f<d;f++)e[f]=arguments[f];return this.then(function(){for(var d=arguments.length,f=Array(d),g=0;g<d;g++)f[g]=arguments[g];return b.call.apply(b,[a].concat(f,e))})}}addFn(function(b,a){var c=void 0===a?identity:a,d=this,e=[],f=b.map(function(a,b){return d.then(function(){return a}).then(function(a){e.push(a);return c(a,b)})});return Promsync.all(f).then(function(){return e})});
addFn(function(b,a){var c=void 0===a?identity:a,d=[];return b.reduce(function(a,b,k){return a.then(function(){return b}).then(function(a){d.push(a);return c(a,k)})},this).then(function(){return d})});
function inChunks(b,a,c,d,e){var f=void 0===d?identity:d,k=void 0===e?identity:e;d=a.length;var h=[],g=!1;e=function(a){h=h.concat(a);k(a)};for(var m=function(d){var k=b,e=[],h=a.slice(d,d+c);return function(){if(g)throw new Break;var a=h.map(function(a,b){b+=d;return k.then(function(){return a}).then(function(a){if(g)throw new Break;e.push(a);return f(a,b)})});return Promsync.all(a).then(function(){return e})}},l=0;l<d&&!g;l+=c)b=b.then(m(l)).then(e);return{promise:stoppable(b.then(function(){return h})),
stop:function(){g=!0;return b}}}addFn(function(b,a,c){return inChunks(this,b,a,c).promise});addFn(function(b,a){var c=this,d=void 0===a?identity:a,e=b.map(function(a,b){return c.then(function(){return a}).then(function(a){return d(a,b)})});return Promsync.all(e)});addFn(function(b,a){var c=void 0===a?identity:a,d=this,e=[];b.forEach(function(a,b){d=d.then(function(){return a}).then(function(a){return c(a,b)}).then(function(a){return e.push(a)})});return d.then(function(){return e})});
addFn(function(b,a){var c=this,d=void 0===a?identity:a,e={},f=Object.keys(b).map(function(a){return c.then(function(){return b[a]}).then(function(b){e[a]=b;return d(b,a)})});return Promsync.all(f).then(function(){return e})});addFn(function(b,a){var c=void 0===a?identity:a,d={};return Object.keys(b).reduce(function(a,f){return a.then(function(){return b[f]}).then(function(a){d[f]=a;return c(a,f)})},this).then(function(){return d})});
addFn(function(b,a,c){var d=void 0===c?identity:c,e={};c=function(a){return Object.assign(e,a)};for(var f=Object.keys(b),k=this,h=function(c){var g={},h=f.slice(c,c+a).map(function(a){return k.then(function(){return b[a]}).then(function(b){e[a]=b;return d(b,a)})});return k.then(function(){return Promsync.all(h).then(function(){return g})})},g=0;g<f.length;g+=a)k=h(g).then(c);return k.then(function(){return e})});
function filterItem(b,a,c,d,e){var f=void 0;return b.then(function(){return c}).then(function(a){f=a;return e(a,d)}).then(function(b){b&&a.push(f)})}function filter(b,a){var c=this,d=void 0===a?identity:a,e=[],f=b.map(function(a,b){return filterItem(c,e,a,b,d)});return Promsync.all(f).then(function(){return e})}addFn(filter);addFn(function(b,a){var c=[];return b.reduce(function(b,e,f){return filterItem(b,c,e,f,a)},this).then(function(){return c})});
addFn(function(b,a,c){return this.then(function(){return Promsync.all([a,Promsync.all(b)])}).then(function(a){a=_slicedToArray(a,2);return a[1].reduce(c,a[0])})});addFn(function(b,a,c){return this.then(function(){return Promsync.all([a,Promsync.all(b)])}).then(function(a){a=_slicedToArray(a,2);return a[1].reduceRight(c,a[0])})});
function detect(b,a){var c=this;return new Promsync(function(d,e){var f=b.map(function(b,e){return c.then(function(){return b}).then(function(b){return Promsync.all([b,a(b,e)])}).then(function(a){a=_slicedToArray(a,2);var b=a[0];a[1]&&d(b)})});Promsync.all(f).then(function(){d()})["catch"](e)})}addFn(detect);
addFn(function(b,a){var c=this,d=void 0===a?identity:a;return new Promsync(function(a,f){b.reduce(function(b,c,f){return b.then(function(){return c}).then(function(a){return Promsync.all([a,d(a,f)])}).then(function(b){b=_slicedToArray(b,2);var c=b[0];b[1]&&a(c)})},c).then(function(){a()})["catch"](f)})});addFn(function(b,a){return Promsync.all(b).then(function(b){b.sort(a);return b})});addFn(function(b,a){return detect.call(this,b,a).then(function(a){return!!a})});
addFn(function(b,a){return filter.call(this,b,a).then(function(a){return a.length===b.length})});function seriesArray(b,a,c){var d=[];return a.reduce(function(a,b){return a.then(function(){return b}).then(function(a){return a.apply(null,c)}).then(function(a){return d.push(a)})},b).then(function(){return d})}
function seriesObj(b,a){var c={};return Object.keys(a).reduce(function(b,e){var f=a[e];return b.then(function(){return f}).then(function(a){return a()}).then(function(a){return c[e]=a})},b).then(function(){return c})}addFn(function(b){return Array.isArray(b)?seriesArray(this,b):seriesObj(this,b)});function parallelArray(b,a,c){return Promsync.all(a.map(function(a){return b.then(function(){return a}).then(function(a){return a.apply(null,c)})}))}
function parallelObj(b,a){var c={},d=Object.keys(a).map(function(d){var f=a[d];return b.then(function(){return f}).then(function(a){return a()}).then(function(a){return c[d]=a})});return Promsync.all(d).then(function(){return c})}addFn(function(b){return Array.isArray(b)?parallelArray(this,b):parallelObj(this,b)});
function parallelLimitArray(b,a,c,d){function e(a){k=k.concat(a);f(a)}var f=void 0===d?identity:d;d=a.length;for(var k=[],h=0;h<d;h+=c){var g=a.slice(h,h+c);b=parallelArray(b,g).then(e)}return b.then(function(){return k})}function parallelLimitObj(b,a,c){function d(b){var d={};f.slice(b,b+c).forEach(function(b){return d[b]=a[b]});return d}function e(a){Object.assign(k,a)}for(var f=Object.keys(a),k={},h=0;h<f.length;h+=c){var g=d(h);b=parallelObj(b,g).then(e)}return b.then(function(){return k})}
addFn(function(b,a){return Array.isArray(b)?parallelLimitArray(this,b,a):parallelLimitObj(this,b,a)});function recurWhilst(b,a,c){b=b.then(function(){return a()}).then(function(a){if(a)return c();throw new Break;});return b.then(function(){return recurWhilst(b,a,c)})}function whilst(b,a){var c=this;return stoppable(this.then(function(){return recurWhilst(c,b,a)}))}addFn(whilst);addFn(function(b,a){var c=this.then(function(){return b()});return whilst.call(c,a,b)});
function until(b,a){var c=this;return whilst.call(this,function(){return c.then(function(){return b()}).then(function(a){return!a})},a)}addFn(until);addFn(function(b,a){var c=this.then(function(){return b()});return until.call(c,a,b)});addFn(function(b){var a=this;return this.then(function(){return recurWhilst(a,function(){return!0},b)})});
function seq(){for(var b=this,a=arguments.length,c=Array(a),d=0;d<a;d++)c[d]=arguments[d];return function(a){return c.reduce(function(a,b){return a.then(function(a){return b(a)})},b.then(function(){return a}))}}addFn(seq);addFn(function(){for(var b=arguments.length,a=Array(b),c=0;c<b;c++)a[c]=arguments[c];a=a.slice();a.reverse();return seq.apply(this,a)});addFn(function(b){for(var a=arguments.length,c=Array(1<a?a-1:0),d=1;d<a;d++)c[d-1]=arguments[d];return parallelArray(this,b,c)});
addFn(function(b){for(var a=arguments.length,c=Array(1<a?a-1:0),d=1;d<a;d++)c[d-1]=arguments[d];return seriesArray(this,b,c)});
addFn(function(b,a){var c=this,d=void 0===a?1:a,e=!1,f=!1,k=!1,h=void 0,g=void 0,m=void 0,l=void 0,m=l=identity,n=function(){if(k)return Promsync.resolve();f=e=!0;h=inChunks(c,g,d,b,m);return h.promise.then(function(a){f=!1;g=[];return a}).then(l)},g=[];return Object.defineProperties({push:function(){g.push.apply(g,arguments);return n()},unshift:function(){g.unshift.apply(g,arguments);return n()},pause:function(){k=!0},resume:function(){k=!1;return n()},kill:function(){g=[];if(h)return h.stop()}},
{length:{get:function(){return g.length},configurable:!0,enumerable:!0},started:{get:function(){return e},configurable:!0,enumerable:!0},running:{get:function(){return f},configurable:!0,enumerable:!0},idle:{get:function(){return!g.length},configurable:!0,enumerable:!0},concurrency:{get:function(){return d},set:function(a){d=a},configurable:!0,enumerable:!0},saturated:{set:function(a){m=a},configurable:!0,enumerable:!0},empty:{set:function(a){},configurable:!0,enumerable:!0},drain:{set:function(a){l=
a},configurable:!0,enumerable:!0}})});module.exports=exports["default"];
